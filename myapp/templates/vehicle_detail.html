{% extends 'bases.html' %}
{% load static %}
{% load humanize %}

{% block title %} Product Details - {{ product_info.brand }} {{ product_info.vehicle_model }} {% endblock %}

{% block content %}
<!-- Use Tailwind CSS CDN for modern styling -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Custom CSS for a premium look */
    .bg-gradient-gray {
        background-image: linear-gradient(to bottom, #f9fafb, #e5e7eb);
    }
    .carousel-item img {
        height: 600px;
        object-fit: contain;
    }
    .sticky-sidebar {
        top: 2rem;
    }
    .info-icon {
        width: 2rem;
        height: 2rem;
        color: #6b7280;
    }
    .icon-text-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 0.5rem;
        transition: transform 0.2s ease-in-out;
    }
    .icon-text-container:hover {
        transform: scale(1.05);
    }
    .action-button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem;
        border-radius: 9999px;
        font-weight: 600;
        transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
    }
    .action-button:hover {
        transform: translateY(-2px);
    }
    .whatsapp-button {
        background-color: #25D366;
        color: white;
    }
    .whatsapp-button:hover {
        background-color: #128C7E;
    }
    .call-button {
        background-color: #4CAF50;
        color: white;
    }
    .call-button:hover {
        background-color: #45a049;
    }
    .report-button {
        color: #ef4444;
    }
    .report-button:hover {
        color: #dc2626;
    }
</style>

<div class="container mx-auto px-4 py-8">
    <!-- Hero Section -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8 lg:flex lg:items-center lg:justify-between">
        <div class="flex-1">
            <h1 class="text-4xl lg:text-5xl font-extrabold text-gray-900 mb-2">{{ product_info.brand }} {{ product_info.vehicle_model }}</h1>
            <h2 class="text-3xl font-bold text-primary-600 mb-4">â‚¦{{ product_info.price|floatformat:2|intcomma }}</h2>
            <div class="flex items-center text-gray-500 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="3"/></svg>
                <span>{{ product_info.town }}, {{ product_info.state }}</span>
            </div>
            <div class="flex items-center text-gray-500 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <span>Posted {{ created_ago }}</span>
            </div>
        </div>
    </div>

    <!-- Main Content & Sidebar -->
    <div class="lg:grid lg:grid-cols-3 lg:gap-8">
        <!-- Main Product Information Column (Left) -->
        <div class="lg:col-span-2">
            <!-- Image Gallery Carousel -->
            <div id="vehicleCarousel" class="carousel slide relative mb-8 rounded-xl overflow-hidden shadow-lg">
                <div class="carousel-inner">
                    {% for image in carousel %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ image.url }}" class="d-block w-full h-full object-contain" alt="Vehicle image {{ forloop.counter }}">
                        </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#vehicleCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#vehicleCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
            </div>

            <!-- Key Specifications -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Key Specifications</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 text-center">
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12h-2m-2 0h-2m-2 0H9m-2 0H5m-2 0a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4zM2 9v6m-1-3h20M7 6v14M17 6v14"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.vehicle_model.name }}</span>
                        <span class="text-xs font-semibold text-gray-400">Model</span>
                    </div>
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.manufacture_year }}</span>
                        <span class="text-xs font-semibold text-gray-400">Year</span>
                    </div>
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 00-9.95 10.42c.07.4.3.73.6.99l9.35 8.59a.8.8 0 001.03 0l9.35-8.59c.3-.26.53-.59.6-.99A10 10 0 0012 2z"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.condition }}</span>
                        <span class="text-xs font-semibold text-gray-400">Condition</span>
                    </div>
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8l-4-4-4 4-4-4M6 16l4 4 4-4 4 4"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.transmission|lower|capfirst }}</span>
                        <span class="text-xs font-semibold text-gray-400">Transmission</span>
                    </div>
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L6 22l6-4 6 4-6-20z"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.fuel_option }}</span>
                        <span class="text-xs font-semibold text-gray-400">Fuel</span>
                    </div>
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h1a2 2 0 012 2v3a2 2 0 01-2 2h-1M21 16H3M3 10h1a2 2 0 012 2v3a2 2 0 01-2 2h-1M12 18v3m0-6v-3"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.mileage|default:'N/A' }}</span>
                        <span class="text-xs font-semibold text-gray-400">Mileage</span>
                    </div>
                    <div class="icon-text-container">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 00-9.95 10.42c.07.4.3.73.6.99l9.35 8.59a.8.8 0 001.03 0l9.35-8.59c.3-.26.53-.59.6-.99A10 10 0 0012 2z"/></svg>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.drive_terrain|default:'N/A' }}</span>
                        <span class="text-xs font-semibold text-gray-400">Drive Terrain</span>
                    </div>
                    <div class="icon-text-container">
                        <span class="w-8 h-8 rounded-full border border-gray-300" style="background-color: {{ product_info.color.name|lower }};"></span>
                        <span class="mt-2 text-sm text-gray-600">{{ product_info.color }}</span>
                        <span class="text-xs font-semibold text-gray-400">Color</span>
                    </div>
                </div>
            </div>

            <!-- Seller's Description -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Seller's Description</h3>
                <p class="text-gray-700 leading-relaxed">{{ product_info.description|default:'The seller has not provided a detailed description for this vehicle.' }}</p>
            </div>

            <!-- Additional Features -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Additional Features</h3>
                <ul class="list-disc list-inside space-y-1 text-gray-700">
                    {% for tag in product_info.vas.all %}
                        <li>{{ tag.name }}</li>
                    {% empty %}
                        <li>No additional features listed.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Sidebar Column (Right) -->
        <div class="lg:col-span-1">
            <div class="lg:sticky-sidebar lg:h-screen lg:pb-16 flex flex-col gap-4">
                <!-- Seller Details Card -->
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center text-center">
                    <img src="https://placehold.co/100x100/A0AEC0/000?text=Seller" alt="Seller's Profile" class="w-24 h-24 rounded-full border-4 border-gray-200 mb-4">
                    <h4 class="text-xl font-semibold text-gray-900">{{ user.full_name|default:"Merchant" }}</h4>
                    <p class="text-gray-500 mb-4">Verified Merchant</p>
                    <a href="tel:{{ user.phone_number|default:'1234567890' }}" class="action-button call-button w-full mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 01-2 2h-3.92a.9.9 0 01-.6-.22l-2.43-2.43a1 1 0 01-.22-.6l-.08-1.5a1 1 0 01.3-.77l1.7-1.7a1 1 0 01.77-.3h1.5a1 1 0 01.6.22l2.43 2.43a.9.9 0 01.22.6zM22 6.92v3a2 2 0 01-2 2h-3.92a.9.9 0 01-.6-.22l-2.43-2.43a1 1 0 01-.22-.6l-.08-1.5a1 1 0 01.3-.77l1.7-1.7a1 1 0 01.77-.3h1.5a1 1 0 01.6.22l2.43 2.43a.9.9 0 01.22.6zM22 2.92v3a2 2 0 01-2 2h-3.92a.9.9 0 01-.6-.22l-2.43-2.43a1 1 0 01-.22-.6l-.08-1.5a1 1 0 01.3-.77l1.7-1.7a1 1 0 01.77-.3h1.5a1 1 0 01.6.22l2.43 2.43a.9.9 0 01.22.6z"/></svg>
                        <span>Call Merchant</span>
                    </a>
                    <a href="https://wa.me/{{ user.phone_number|default:'1234567890' }}" target="_blank" class="action-button whatsapp-button w-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12c0 3.18 1.44 6.01 3.71 7.91L3.5 22.5l2.4-1.2A9.95 9.95 0 0012 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm3.5 13.5L13.2 11.3l-1.1 1.1-1.1-1.1-1.1 1.1-1.1-1.1L8.5 13.5l1.1 1.1 1.1-1.1L12 13.5l1.1 1.1 1.1-1.1 1.1 1.1z"/></svg>
                        <span>Chat on WhatsApp</span>
                    </a>
                </div>

                <!-- Safety Tips and Report -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Safety Tips</h4>
                    <ul class="text-sm text-gray-600 list-disc list-inside space-y-1 mb-4">
                        <li>Avoid sending any prepayments.</li>
                        <li>Meet in a safe public place.</li>
                        <li>Inspect the vehicle and documents before paying.</li>
                        <li>Verify the seller's details.</li>
                    </ul>
                    <hr class="my-4">
                    <button type="button" class="text-sm font-semibold flex items-center gap-2 report-button" data-bs-toggle="modal" data-bs-target="#reportModal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/></svg>
                        Report This Listing
                    </button>
                    <button type="button" class="text-sm font-semibold flex items-center gap-2 text-gray-600 mt-2" data-bs-toggle="modal" data-bs-target="#feedbackModal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 17h5a2 2 0 002-2v-5a2 2 0 00-2-2h-5m-5 0h-5a2 2 0 00-2 2v5a2 2 0 002 2h5m-5-2h5m-5-4h5M12 22V2"/></svg>
                        Leave Feedback
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Abuse Modal -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reportModalLabel">Report Listing</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" method="post">
                <div class="modal-body">
                    <p class="text-sm text-gray-500 mb-4">Please provide details about why you are reporting this listing.</p>
                    <div class="mb-3">
                        <label for="report-reason" class="form-label">Reason for Report</label>
                        <select id="report-reason" class="form-select" required>
                            <option value="">Select a reason</option>
                            <option value="scam">This is a scam</option>
                            <option value="spam">Spam or irrelevant content</option>
                            <option value="misleading">Misleading information</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="report-details" class="form-label">Details</label>
                        <textarea id="report-details" class="form-control" rows="3" placeholder="Provide more details here..." required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Submit Report</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Leave Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="feedbackModalLabel">Leave Feedback</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" method="post">
                <div class="modal-body">
                    <p class="text-sm text-gray-500 mb-4">Your feedback helps us improve our service.</p>
                    <div class="mb-3">
                        <label for="feedback-subject" class="form-label">Subject</label>
                        <input type="text" id="feedback-subject" class="form-control" placeholder="e.g., Issue with a feature">
                    </div>
                    <div class="mb-3">
                        <label for="feedback-message" class="form-label">Your Message</label>
                        <textarea id="feedback-message" class="form-control" rows="4" placeholder="Type your message here..." required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Feedback</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
